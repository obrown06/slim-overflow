<html>
<head>

</head>

<body>
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript">
      $(document).ready(function(){
        $("#upvoteQuestion").click(function() {
          $.ajax({
              url: "<%= question_path(@conn, :upvote, @question) %>",
              type: "GET",
              dataType: "json",
              success: function(data){
                  if (data.upvote_successful === true)
                  {
                    var count = parseInt($('#question-vote-count').text());
                    $('#question-vote-count').text(count + 1)
                  }
              },
              error: function(error){
                   console.log("Error:");
                   console.log(error);
              }
          });
        });

        $("#downvoteQuestion").click(function() {
          $.ajax({
              url: "<%= question_path(@conn, :downvote, @question) %>",
              type: "GET",
              dataType: "json",
              success: function(data){
                  if (data.downvote_successful === true)
                  {
                    var count = parseInt($('#question-vote-count').text());
                    $('#question-vote-count').text(count - 1)
                  }
              },
              error: function(error){
                   console.log("Error:");
                   console.log(error);
              }
          });
        });
      });
  </script>

<h2> <%= title(@question) %> </h2>
<button id="upvoteQuestion" type="button">Upvote Question</button>
<button id="downvoteQuestion" type="button">Downvote Question</button>

<div id="question-vote-count">
  <%= vote_count(@question) %>
</div>
<hr>

<h5> <%= body(@question) %> </h5>

<%= for category <- list_categories(@question) do %>
  <div class="category-tag">
     <%= link Categories.name(category), to: category_path(@conn, :show, category) %>
  </div>
<% end %>

<div class="user-tag">
  <div class = "user-img">
    <img src="<%= PlungerWeb.Avatar.url({user(@question).avatar, user(@question)}) %>" width="50" height="50"/>
  </div>
  <div class = "user-time-posted">
    asked <%= time_posted(@question) %>
  </div>
  <div class = "user-name">
    <%= link user_name(@question), to: user_path(@conn, :show, user(@question)) %>
  </div>
</div>


<%= if current_user(@conn).is_admin or current_user(@conn).id == @question.user_id do %>
  <span><%= link "Edit", to: question_path(@conn, :edit, @question), class: "btn btn-default btn-xs" %></span>
<% end %>

<span><%= link "Question List", to: question_path(@conn, :index) %></span>

<!--
<div id="messages"></div>
<input id="chat-input" type="text"></input>
-->

<div class="comments">
 <h2>Comments</h2>
 <%= for comment <- PlungerWeb.QuestionView.list_comments(@question) do %>
   <%= render PlungerWeb.CommentView, "show.html", comment_changeset: @comment_changeset, conn: @conn, comment: comment, question: @question %>
 <% end %>
</div>

<%= render PlungerWeb.CommentView, "form.html", conn: @conn, question: @question,
  comment_changeset: @comment_changeset, action: comment_path(@conn, :create, parent_type: "question", question_id: @question.id)
%>

<div class="responses">
 <h2>Responses</h2>
 <%= for response <- list_responses(@question) do %>
   <hr>
   <%= render PlungerWeb.ResponseView, "show.html", conn: @conn, comment_changeset: @comment_changeset, response: response, question: @question %>
 <% end %>
</div>

<%= render PlungerWeb.ResponseView, "form.html", conn: @conn,
  response_changeset: @response_changeset, action: response_path(@conn, :create, question_id: @question.id)
%>

<%= render PlungerWeb.ChannelView, "show.html", question: @question %>

</body>
